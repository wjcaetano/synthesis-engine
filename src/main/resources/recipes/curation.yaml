config:
  fresh: true
  options:
    - name: inputPackage
      type: FILE
      subType: LIST
      label: "Curated Zip Package"
executor: ProjectModelExecutor3.java
projectModel:
  filesTree.json: "${#recipe['templates']['filesTree']}"
  curatedFiles: "${#recipe['templates']['curatedFiles']}"
  processedPackage.zip: "${#recipe['templates']['processedPackage']}"
templates:
  filesTree: |-
    @@@get("$api.configs.options.inputPackage")
    @@@spel("${@FileUtils.zipToMapOfStrings(#content, true)}")
    @@@_set("allFilesAndFolders")
    @@@get("${#content.?[value != null && value.startsWith('data:text')]}")
    @@@_set("allTextFiles")
    @@@jsonify
  curatedFiles: |-
    @@@script("CurationIdentification")
    @@@_set("mapOfIdentifiedFiles")
  processedPackage: |-
    @@@get("${#rootFolder + '/' + #fileFolder + '/curatedFiles'}")
    @@@spel("${@FileUtils.zipFileToBytes(#content)}")
  #oldProcessedPackage: |-
  #  @@@get("${#rootFolder + '/' + #fileFolder + '/curatedFiles'}")
  #  @@@_set("pathToZip")
  #  @@@get("${#fullFilePath.replace('processedPackage.zip', 'tempPackage.zip')}")
  #  @@@_set("zipFilePath")
  #  @@@_spel("${@FileUtils.zipFile(#pathToZip, #zipFilePath)}")
  #  @@@spel("${T(java.nio.file.Path).of(#zipFilePath)}")
  #  @@@spel("${T(java.nio.file.Files).readAllBytes(#content)}")
scripts:
  CurationIdentification:
    reference: CurationIdentification.groovy
    type: GROOVY
